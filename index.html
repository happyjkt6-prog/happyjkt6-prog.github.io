<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura RP - Immersive AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .glass { background: rgba(15, 15, 20, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        body { background-color: #09090b; color: #f4f4f5; }
        #bg-image { transition: background-image 1.5s ease-in-out; }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden font-sans">

    <div id="bg-image" class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=1920');">
        <div class="absolute inset-0 bg-gradient-to-b from-purple-900/30 via-black/60 to-black"></div>
    </div>

    <header class="relative z-20 flex items-center justify-between p-4 glass">
        <div class="flex items-center gap-2">
            <i data-lucide="sparkles" class="text-purple-400"></i>
            <h1 class="font-bold text-lg uppercase tracking-widest">Aura RP</h1>
        </div>
        <button onclick="clearChat()" class="p-2 text-zinc-400 hover:text-red-400"><i data-lucide="trash-2"></i></button>
    </header>

    <main id="chat-box" class="relative z-10 h-[calc(100%-140px)] overflow-y-auto p-4 space-y-4 scrollbar-hide flex flex-col pt-10"></main>

    <div class="absolute bottom-0 left-0 right-0 z-20 p-4 bg-gradient-to-t from-black to-transparent">
        <div class="max-w-4xl mx-auto flex items-center gap-2 glass rounded-2xl p-2 pl-4">
            <input id="user-input" type="text" placeholder="Type your action..." class="flex-1 bg-transparent border-none outline-none text-sm text-white">
            <button onclick="sendMessage()" class="p-2 bg-purple-600 rounded-xl text-white shadow-lg"><i data-lucide="send"></i></button>
        </div>
    </div>

    <audio id="bg-music" loop></audio>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // --- CONFIGURATION ---
        // PASTE YOUR API KEY HERE
        const API_KEY = AIzaSyDk11_rFALXwt0ExrrhP5oY1N4Swfx4_XA; 
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ 
            model: "gemini-1.5-flash",
            systemInstruction: "You are a professional RP narrator. End EVERY response with tags: [BG: URL] [Music: mood]. Moods: mystery, intense, calm, sad, epic."
        });

        let chat = model.startChat({ history: [] });

        window.sendMessage = async () => {
            const inputField = document.getElementById('user-input');
            const text = inputField.value.trim();
            if (!text) return;

            addMessage('user', text);
            inputField.value = '';

            try {
                const result = await chat.sendMessage(text);
                const responseText = await result.response.text();
                processResponse(responseText);
            } catch (err) {
                addMessage('model', "System Error: Check your API Key or Internet.");
            }
        };

        function processResponse(rawText) {
            // Extract Background URL
            const bgMatch = rawText.match(/\[BG:\s*(.*?)\]/);
            if (bgMatch) document.getElementById('bg-image').style.backgroundImage = `url('${bgMatch[1]}')`;

            // Clean text (remove tags from user view)
            const cleanText = rawText.replace(/\[.*?\]/g, '').trim();
            addMessage('model', cleanText);
        }

        function addMessage(role, text) {
            const box = document.getElementById('chat-box');
            const msgDiv = document.createElement('div');
            msgDiv.className = `max-w-[85%] p-3 rounded-2xl shadow-lg ${role === 'user' ? 'ml-auto bg-purple-600/40 border-purple-500/30' : 'mr-auto glass border-white/10'}`;
            msgDiv.innerHTML = `<p class="text-sm">${text}</p>`;
            box.appendChild(msgDiv);
            box.scrollTop = box.scrollHeight;
        }

        window.clearChat = () => {
            document.getElementById('chat-box').innerHTML = '';
            chat = model.startChat({ history: [] });
        };

        lucide.createIcons();
    </script>
</body>
  </html>
